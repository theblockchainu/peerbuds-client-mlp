<div class="row">
  <div class="col-md-12">
    <div *ngIf="!loaded" class="center">
      <i class="fa fa-spinner fa-spin" style="font-size:24px"></i>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-12" *ngIf="loaded">
    <div class="row">
      <div>
        <div style="margin-top:20px;" class="col-md-12">
          <div class="row" style="margin-right: 20px;">
            <mat-tab-group>
              <mat-tab label="Reviews About You">
                <div style="margin-top: 25px; margin-bottom: 50px;" class="lightText">
                  Reviews are written at the end of the workshop or experience or session through peerbuds. Reviews you have received will be visible both here and on your public profile.
                </div>
                <div class="review-section" *ngFor="let review of profile.peer[0].reviewsAboutYou">
                  <div *ngIf="review.peer !== undefined">
                    <div class="review-top">
                      <div class="review-thumb pull-left">
                        <img src="{{ review.peer[0].profiles[0].picture_url}}" alt=" " class="circle-thumb" (error)="consoleProfileComponent.imgErrorHandler($event)">
                      </div>
                      <div class="reviewer">
                        <div class="reviewer-name">{{ review.peer[0].profiles[0].first_name + ' ' + review.peer[0].profiles[0].last_name }}</div>
                        <div class="reviewer-headline">{{ review.peer[0].profiles[0].headline }}</div>
                      </div>
                    </div>
                    <div class="review-content">
                      <div class="review-bottom lightText">
                        <span>{{ getReviewedCollection(profile.peer[0], review.collectionId).type | titlecase}} : <a href="javascript:;">{{ getReviewedCollection(profile.peer[0], review.collectionId).title }}</a></span>
                        <span class="bullet">
                          <p-rating [(ngModel)]="review.score" [cancel]="false" [readonly]="true"></p-rating>
                        </span>
                        <span class="bullet">{{ getReviewedCalendar(getReviewedCollection(profile.peer[0], review.collectionId).calendars, review.collectionCalendarId).startDate | date: 'dd MMM' }} - {{ getReviewedCalendar(getReviewedCollection(profile.peer[0], review.collectionId).calendars, review.collectionCalendarId).endDate | date: 'dd MMM' }}</span>
                      </div>
                      <div class="review-desc">{{ review.description }}</div>
                    </div>
                  </div>
                </div>
              </mat-tab>
              <mat-tab label="Reviews By You">
                <div style="margin-top: 25px; margin-bottom: 50px;" class="lightText">
                  Reviews are written at the end of the workshop or experience or session through peerbuds. Reviews you have received will be visible both here and on your public profile.
                </div>
                <div class="review-section-title" *ngIf="getPendingReviewCollections(profile.peer[0]) !== undefined && getPendingReviewCollections(profile.peer[0]).length > 0">
                  Reviews To Write
                </div>
                <div class="row" style="margin-left: -12px; margin-bottom: 20px;" *ngIf="getPendingReviewCollections(profile.peer[0]) !== undefined && getPendingReviewCollections(profile.peer[0]).length > 0">
                  <div>
                    <div style="margin-top:20px;" class="col-md-12">
                      <div class="row">
                        <div *ngFor="let collection of getPendingReviewCollections(profile.peer[0])" [ngSwitch]="collection.status">
                          <ng-template #topicName>{{collection.topics[0].name | titlecase}}</ng-template>
                          <ng-template #noTopicText>No Topics</ng-template>
                          <div class="col-md-4" style="margin-top: 20px;" *ngSwitchCase="'complete' || 'canceled'" >
                            <mat-card style="text-align: center; padding: 20px;">
                              <mat-card-content>
                                <div class="clearfix" style="text-align: right">
                                  <div class="pull-right">
                                    <a mat-button [matMenuTriggerFor]="collectionCardMenu" style="text-align: right; padding: 0px">
                                      <mat-icon>more_vert</mat-icon>
                                    </a>
                                  </div>
                                </div>
                                <div style="text-align: center">
                                  <div class="pull-left">
                                    <mat-chip-list class="cardTypeChip">
                                      <mat-chip class="smallChip" [color]="'accent'" *ngIf="collection.type == 'workshop'">W</mat-chip>
                                      <mat-chip class="smallChip" [color]="'accent'" *ngIf="collection.type == 'experience'">E</mat-chip>
                                      <mat-chip class="smallChip" [color]="'accent'" *ngIf="collection.type == 'session'">S</mat-chip>
                                    </mat-chip-list>
                                  </div>
                                </div>
                                <div class="collectionParticipantImageCarousel">
                                  <div class="image-inline" *ngFor="let participant of collection.participants">
                                    <img src="{{ participant?.profiles[0].picture_url }}" alt=" " class="circle-thumb-overlap" (error)="consoleProfileComponent.imgErrorHandler($event)">
                                  </div>
                                  <div class="image-inline" *ngIf="collection.participants.length === 0">
                                    <img src="/assets/images/user-placeholder.jpg" alt=" " class="circle-thumb-overlap" (error)="consoleProfileComponent.imgErrorHandler($event)">
                                  </div>
                                </div>
                                <div class="participantCount">
                                  <span>{{collection.participants.length}} Participants </span>
                                </div>
                                <div class="collectionTitle">{{ collection.title || 'No Title' }} </div>
                                <mat-progress-bar mode="determinate" value="{{_collectionService.getProgressValue(collection)}}"></mat-progress-bar>
                                <div class="collectionSubtitle" >
                                  {{ _collectionService.calculateNumberOfDays(collection.calendars[0]) }} Days | {{collection.contents.length}} Parts | <span *ngIf="collection.topics.length > 0; then topicName else noTopicText"></span>
                                </div>
                              </mat-card-content>
                              <mat-card-actions>
                                <div class="teachingRatingReminder" (click)="_collectionService.viewWorkshop(collection)">
                                  Finish rating 4 other students
                                </div>
                              </mat-card-actions>
                              <br><br>
                              <mat-card-footer class="cardFooter">
                                <button mat-button (click)="_collectionService.viewTransactions()">View Transactions</button>
                              </mat-card-footer>
                            </mat-card>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="review-section-title" *ngIf="profile.peer[0].reviewsByYou !== undefined && profile.peer[0].reviewsByYou.length > 0">
                  Reviews You've Written
                </div>
                <div class="review-section" *ngFor="let review of profile.peer[0].reviewsByYou">
                  <div *ngIf="review.reviewedPeer !== undefined">
                    <div class="review-top">
                      <div class="review-thumb pull-left">
                        <img src="{{ review.reviewedPeer[0].profiles[0].picture_url}}" alt=" " class="circle-thumb" (error)="consoleProfileComponent.imgErrorHandler($event)">
                      </div>
                      <div class="reviewer">
                        <div class="reviewer-name">{{ review.reviewedPeer[0].profiles[0].first_name + ' ' + review.reviewedPeer[0].profiles[0].last_name }}</div>
                        <div class="reviewer-headline">{{ review.reviewedPeer[0].profiles[0].headline }}</div>
                      </div>
                    </div>
                    <div class="review-content">
                      <div class="review-bottom lightText">
                        <span>{{ getReviewedCollection(profile.peer[0], review.collectionId).type | titlecase }} : <a href="javascript:;">{{ getReviewedCollection(profile.peer[0], review.collectionId).title }}</a></span>
                        <span class="bullet">
                          <p-rating [(ngModel)]="review.score" [cancel]="false" [readonly]="true"></p-rating>
                        </span>
                        <span class="bullet">{{ getReviewedCalendar(getReviewedCollection(profile.peer[0], review.collectionId).calendars, review.collectionCalendarId).startDate | date: 'dd MMM' }} - {{ getReviewedCalendar(getReviewedCollection(profile.peer[0], review.collectionId).calendars, review.collectionCalendarId).endDate | date: 'dd MMM' }}</span>
                      </div>
                      <div class="review-desc">{{ review.description }}</div>
                    </div>
                  </div>
                </div>
              </mat-tab>
            </mat-tab-group>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<mat-menu #collectionCardMenu>
  <button mat-menu-item>
    Delete
  </button>
  <button mat-menu-item>
    Message Students
  </button>
</mat-menu>
